# 概述
- 本文档主要描述本仲裁人节点需要的检测事项，目的是第一时间知道本仲裁人节点正常异常状态，如有异常现象发送邮件预警，并正确处理。

- 保证仲裁人节点可以正常共识出块，务必清楚节点在异常情况下可以快速处理，避免造成自己不必要的损失。 
- 监测报告每天早上9点和下午7点发送邮件，节点预警邮件实时发送

## 1.监测项
#### 1.1 区块高度不同步预警

    本仲裁人节点与其他节点高度不一致，发送预警邮件，避免仲裁人不能正常共识出块，造成损失，可通过重启节点观察区块高度是否同步，Dpos直连网络是否正常（可通过1.8直连报告程序观察）。区块同步并且直连状态正常，表示本仲裁人节点正常运行。
    
    
- 邮件格式

    时间 | 上次区块高度| 当前区块高度
    ---|---|---
    2019-06-07 02:45:37 | 359574| 359574


#### 1.2 节点RPC无法连接

    本仲裁人节点RPC请求超时，或者连接拒绝，发送预警邮件。现象可能有服务器无法登陆，硬盘空间不足，节点挂掉风险。如果出现其中一种操作1.1步骤恢复节点。

- 邮件格式

    时间 | 异常信息
    ---|---
    2019-06-14 22:24:53 | HTTPConnectionPool(host='127.0.0.1', port=20336): Max retries exceeded with url: / (Caused by NewConnectionError(': Failed to establish a new connection: [Errno 61] Connection refused',))


#### 1.3 视图切换预警

    本仲裁人Dpos共识视图切换过多，发送预警邮件。可查看Dpos直连网络是否正常，节点是否发送提案共识出块。如果出现其中一种操作1.1步骤恢复节点。

    
- 邮件格式

    序号 | 区块高度| nodepublickey| 切换视图次数
    ---|---|---|---
    1 | 367731| 02e578a6f4295765ad3be4cdac9be15de5aedaf1ae76e86539bb54c397e467cd5e| 7

#### 1.4 连续不发送提案预警

    本仲裁人Dpos共识连续不发送提案，本仲裁人节点不能正常共识出块，发送预警邮件。可操作1.1步骤恢复节点

- 邮件格式

    序号 | nodepublickey| 连续没有轮值区块高度范围
    ---|---|---
    2019-06-07 02:45:37 | 02e578a6f4295765ad3be4cdac9be15de5aedaf1ae76e86539bb54c397e467cd5e| 359550-359573

#### 1.5 状态预警

    本仲裁人Dpos共识出现异常现象，发送预警邮件。inactave 状态表示：本仲裁人已被剔除直连网络，暂时不参与Dpos共识出块，可通过发送active交易，恢复本仲裁人Dpos共识。illegal状态表示：本仲裁人作恶，永久不能参与Dpos共识出块。

- 邮件格式

    nodepublickey| 仲裁人状态
    ---|---
    02e578a6f4295765ad3be4cdac9be15de5aedaf1ae76e86539bb54c397e467cd5e| inactive


#### 1.6 交易池遗留数据预警

    部分交易连续3个区块仍残留在交易池本仲裁人连续3个块没有打包交易，停留在交易池，发送预警邮件。可操作1.1步骤恢复节点

- 邮件格式

    区块高度| 遗留交易数
    ---|---
    359574 | 3
    
#### 1.7 区块高度报告

    定时发送本仲裁人节点高度和相邻节点数，以了解节点是正常状态

- 邮件格式

    时间 | 区块高度| 相邻节点数
    ---|---|---
    2019-06-07 02:45:37 | 399728| 10


#### 1.8 Dpos直连报告

    定时发送Dpos直连状态信息，以了解本仲裁人节点可以正常共识出块

- 邮件格式

    序号 | 区块高度| ownerpublickey| nodepublickey| 连接状态
    ---|---|---|---|---
    1 | 399728| *** 3633d3ddc8b ***| *** 0e3633d3ddc8b ***| 2WayConnection

#### 1.9 仲裁人报告信息

    定时发送仲裁人报告信息，以了解本仲裁人节点共识签名次数、轮值出块次数、切换视图次数

- 邮件格式

    区块高度区间(343400-399732) | nodepublickey| 轮值次数| 签名次数|切换视图次数
    ---|---|---|---|---
    1 | *** ac9be15de5aedaf1ae76e86 *** | 4770| 47791| 1018